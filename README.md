# py-tlgbotcore

[py-tlgbotcore](https://github.com/kaefik/py-tlgbotcore) - –û—Å–Ω–æ–≤–∞ Telegram –±–æ—Ç–∞ —Å —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º —á–µ—Ä–µ–∑ –ø–ª–∞–≥–∏–Ω—ã.

> –í–¥–æ—Ö–Ω–æ–≤–ª—ë–Ω –ø—Ä–æ–µ–∫—Ç–æ–º [UniBorg](https://github.com/udf/uniborg) –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Telethon.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîå –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–≥–∏–Ω–æ–≤ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- üóÑÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SQLite –∏ CSV –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
- üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏
- üé® –¶–≤–µ—Ç–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ñ–∞–π–ª–æ–≤—ã–º –≤—ã–≤–æ–¥–æ–º
- üîß Type hints –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã

- **_core** - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–ª–∞–≥–∏–Ω–∞–º–∏ –∏ –¥–æ—Å—Ç—É–ø–æ–º
- **noauthbot** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- **inline_button** - –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è inline –∫–Ω–æ–ø–æ–∫ (`/inline`)
- **runner_questionnaire** - –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä –∞–Ω–∫–µ—Ç —Å JSON-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º
- **runner_questionnaire_inline_button** - –∞–Ω–∫–µ—Ç—ã —Å inline –∫–Ω–æ–ø–∫–∞–º–∏

## –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
|---------|----------|----------------------|
| `/adduser` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –±–æ—Ç—É | `/adduser` (–¥–∞–ª–µ–µ –±–æ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) |
| `/deluser` | –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–∞ | `/deluser` (–¥–∞–ª–µ–µ –±–æ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è) |
| `/listusers` | –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –±–æ—Ç—É | `/listusers` |
| `/load` | –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞–≥–∏–Ω–∞ | `/load –∏–º—è_–ø–ª–∞–≥–∏–Ω–∞` |
| `/unload` | –í—ã–≥—Ä—É–∑–∫–∞ –ø–ª–∞–≥–∏–Ω–∞ | `/unload –∏–º—è_–ø–ª–∞–≥–∏–Ω–∞` |
| `/reload` | –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞–≥–∏–Ω–∞ | `/reload –∏–º—è_–ø–ª–∞–≥–∏–Ω–∞` |
| `/plugins` | –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤ | `/plugins` |

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/kaefik/py-tlgbotcore.git
cd py-tlgbotcore

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
uv sync

# –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å –ª–∏–Ω—Ç–µ—Ä–∞–º–∏ –∏ —Ç–µ—Å—Ç–∞–º–∏)
uv sync --extra dev
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–°–æ–∑–¥–∞–π—Ç–µ `cfg/config_tlg.py` –Ω–∞ –æ—Å–Ω–æ–≤–µ `cfg/config_tlg_example.py`:

```python
# Telegram API (–ø–æ–ª—É—á–∏—Ç—å –Ω–∞ https://my.telegram.org)
TLG_APP_NAME = "your_app_name"
TLG_APP_API_ID = 12345678
TLG_APP_API_HASH = "your_api_hash"

# Bot Token (–ø–æ–ª—É—á–∏—Ç—å —É @BotFather)
I_BOT_TOKEN = "1234567890:your_bot_token"

# ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
TLG_ADMIN_ID_CLIENT = [123456789]

# –¢–∏–ø –ë–î: "SQLITE" –∏–ª–∏ "CSV"
TYPE_DB = "SQLITE"
SETTINGS_DB_PATH = "settings.db"

# –ü—Ä–æ–∫—Å–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
TLG_PROXY_SERVER = None
TLG_PROXY_PORT = None
TLG_PROXY_KEY = None
```

### 3. –ó–∞–ø—É—Å–∫

```bash
# –ü—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º
uv run tlgbotcore

# –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å DEBUG –ª–æ–≥–∞–º–∏)
python dev_start.py
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
uv run ruff check .

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
uv run ruff format .

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
uv run mypy bot/

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
uv run pytest
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í–º–µ—Å—Ç–æ `cfg/config_tlg.py` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
export TLG_APP_NAME="your_app"
export TLG_APP_API_ID="12345678"
export TLG_APP_API_HASH="your_hash"
export I_BOT_TOKEN="your_token"
export TLG_ADMIN_ID_CLIENT="123456789,987654321"
export TYPE_DB="SQLITE"
export SETTINGS_DB_PATH="settings.db"
```

## –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Systemd —Å–µ—Ä–≤–∏—Å

–°–æ–∑–¥–∞–π—Ç–µ `/etc/systemd/system/tlgbotcore.service`:

```ini
[Unit]
Description=Telegram Bot Core
After=network.target

[Service]
Type=simple
User=tlgbot
WorkingDirectory=/opt/py-tlgbotcore
ExecStart=/opt/py-tlgbotcore/.venv/bin/python -m bot.start_tlgbotcore
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl enable tlgbotcore.service
sudo systemctl start tlgbotcore.service
```

## –ü–ª–∞–≥–∏–Ω—ã –∫ –±–æ—Ç—É

–í—Å–µ –ø–ª–∞–≥–∏–Ω—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ **plugins_bot**. –ü–ª–∞–≥–∏–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø–∞–ø–∫—É —Å –∏–º–µ–Ω–µ–º –ø–ª–∞–≥–∏–Ω–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä –ø—É—Å—Ç—å –ø–ª–∞–≥–∏–Ω
–Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è privet, —Ç–æ–≥–¥–∞ —Å–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É —Å –∏–º–µ–Ω–µ–º privet –≤ –ø–∞–ø–∫–µ –ø–ª–∞–≥–∏–Ω–æ–≤.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–∫–∏ –ø–ª–∞–≥–∏–Ω–∞ privet:

1. —Ñ–∞–π–ª privet.py - —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–∞–º–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å)
2. —Ñ–∞–π–ª privet.md - –°–ø—Ä–∞–≤–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ –ø–ª–∞–≥–∏–Ω–µ. (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–ª–∞–≥–∏–Ω–µ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã **/help –∏–º—è_–ø–ª–∞–≥–∏–Ω–∞**, —Ç–æ–≥–¥–∞ –ª–æ–≥–∏–∫–∞
–≤—ã–≤–æ–¥–∞ —Å–ø—Ä–∞–≤–∫–∏ –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–∞—è:

1. –∏—â–µ—Ç—Å—è —Ñ–∞–π–ª —Å–ø—Ä–∞–≤–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–ª–∞–≥–∏–Ω–∞ **–∏–º—è_–ø–ª–∞–≥–∏–Ω–∞.md** –≤ –ø–∞–ø–∫–µ –ø–ª–∞–≥–∏–Ω–∞
2. –µ—Å–ª–∏ —Ñ–∞–π–ª —Å–ø—Ä–∞–≤–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–ª–∞–≥–∏–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, —Ç–æ –±—É–¥–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å—Å—è docstring –º–æ–¥—É–ª—è.
3. –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω docstring –ø–ª–∞–≥–∏–Ω–∞, —Ç–æ –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º —á—Ç–æ —Å–ø—Ä–∞–≤–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–∞–Ω–Ω–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞ –Ω–µ—Ç.

### –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ –ø–ª–∞–≥–∏–Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –±–æ—Ç—É:

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –Ω–∞–ø—Ä–∏–º–µ—Ä —Å –∏–º–µ–Ω–µ–º privet.py –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ –≤ –ø–∞–ø–∫—É –ø–ª–∞–≥–∏–Ω–æ–≤ (–≤ –º–æ—ë–º —Å–ª—É—á–∞–µ —ç—Ç–æ plugins_bot)

```python
"""
Example plugins for tlgbotcore (send hi)
"""

from telethon import events


@tlgbot.on(events.NewMessage(pattern='hi'))
async def handler(event):
    await event.reply('hey')
```

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –±–æ—Ç—É –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–º—É –∫—Ä—É–≥—É –ª–∏—Ü, —Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –≤ –ø–ª–∞–≥–∏–Ω–∞—Ö –±–æ—Ç–∞:

```python
@tlgbot.on(events.NewMessage(chats=tlgbot.settings.get_all_user_id(), pattern='hi'))
```


### Docker

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t py-tlgbotcore .

# –ó–∞–ø—É—Å–∫ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker run -d \
  --name tlgbotcore \
  --restart unless-stopped \
  -e TLG_APP_NAME="your_app" \
  -e TLG_APP_API_ID="12345678" \
  -e TLG_APP_API_HASH="your_hash" \
  -e I_BOT_TOKEN="your_token" \
  -e TLG_ADMIN_ID_CLIENT="123456789" \
  -v ./logs:/app/logs \
  -v ./settings.db:/app/settings.db \
  py-tlgbotcore

# –õ–æ–≥–∏
docker logs -f tlgbotcore
```

### Docker Compose

```yaml
version: '3.8'
services:
  tlgbotcore:
    build: .
    restart: unless-stopped
    environment:
      - TLG_APP_NAME=your_app
      - TLG_APP_API_ID=12345678
      - TLG_APP_API_HASH=your_hash
      - I_BOT_TOKEN=your_token
      - TLG_ADMIN_ID_CLIENT=123456789
    volumes:
      - ./logs:/app/logs
      - ./settings.db:/app/settings.db
```
